<ion-content>
  <div class="inventory-box">
      <ion-card class="inventory-card">
        <div class="card-header">
            <ion-chip color="success" class="branch-chip">
              <ion-icon name="location" class="location"></ion-icon>
              {{ selectedBranch }}
            </ion-chip>
          <div class="waybill-box">
          <p class="asx">
            Assigned SFX 
            <span class="sfx-number" (click)="openSfxModal()">20</span>
          </p>    
        </div>
        </div>
     <div class="card-content">
    <div class="chart-container">
      <div *ngFor="let item of chartData" class="chart-item" (click)="openModal(item.name)">
        <ngx-charts-bar-horizontal
          [results]="[item]"
          [scheme]="colorScheme"
          [animations]="false"
          [gradient]="false"
          [roundEdges]="true"
          [xAxis]="false"
          [yAxis]="false"
          [showDataLabel]="true"
          [dataLabelFormatting]="dataLabelFormatting"
          [barPadding]="10"
          [tooltipDisabled]="true"
          [view]="[300, 50]"> <!-- Adjusted height for single bar -->
        </ngx-charts-bar-horizontal>
        <span class="label">{{ item.name }}</span>
        <span class="value" (click)="openModal(item.name, $event)">{{ item.value }}</span>
      </div>
    </div>
  </div>
      </ion-card>
  </div>
  <ion-item>
    <ion-label>Today</ion-label>
    <ion-icon name="chevron-down"></ion-icon>
  </ion-item>
  <ion-grid>
    <ion-row>
      <ion-col size="6">
        <ion-card>
          <ion-card-header>
            <div class="amount-wrapper">
              <img src="assets/icon/trip-details.png" alt="Trip" class="tri-icon" />
              Trip Status
            </div>
          </ion-card-header>
          <ion-card-content>
            <ion-grid>
              <ion-row class="header-row">
                <ion-col size="3"><strong>VEH No.</strong></ion-col>
                <ion-col size="3"><strong>MF vs ULD (WB)</strong></ion-col>
                <ion-col size="3"><strong>MF vs ULD (Pkgs)</strong></ion-col>
                <ion-col size="3"><strong>SH/EX</strong></ion-col>
              </ion-row>
              <ion-row *ngFor="let trip of sortedTripStatus" (click)="openShExModal(trip.vehicleNo)" class="clickable-row">
                <ion-col size="3">{{ trip.vehicleNo }}</ion-col>
                <ion-col size="3">{{ trip.manifestedWaybills }}/{{ trip.unloadedWaybills }}</ion-col>
                <ion-col size="3">{{ trip.manifestedPackages }}/{{ trip.unloadedPackages }}</ion-col>
                <ion-col size="3" [class.warning]="trip.shortExcess !== 0">{{ trip.shortExcess }}</ion-col>
              </ion-row>
            </ion-grid>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <ion-col size="6">
        <ion-card>
          <ion-card-header>
            <img src="assets/icon/absent.png" alt="Absent" class="pod-icon" />
            Absent (2)
          </ion-card-header>
          <ion-card-content>
            <ion-grid>
              <ion-row>
                <ion-col size="12"><strong>VEH No.</strong></ion-col>
              </ion-row>
              <ion-row *ngFor="let vehicle of absentVehicles">
                <ion-col size="12">{{ vehicle.vehicleNo }}</ion-col>
              </ion-row>
            </ion-grid>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
  <ion-modal #sfxModal>
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Assigned SFX</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeSfxModal()">Close</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <ion-list>
          <ion-item *ngFor="let sfx of assignedSfxData">
            <ion-label>
              <h2>SFX Code</h2>
              <p>{{ sfx.code }}</p>
              <h2>Consignor</h2>
              <p>{{ sfx.consignor }}</p>
            </ion-label>
            <ion-label slot="end">
              <h2>Last Pickup Date</h2>
              <p>{{ sfx.lastPickupDate }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-content>
    </ng-template>
  </ion-modal>

  <!-- Modal for ZERO PICKUP SFX Details -->
  <ion-modal #zeroPickupModal>
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>ZERO PICKUP SFX</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeZeroPickupModal()">Close</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <ion-list>
          <ion-item *ngFor="let zero of zeroPickupData">
            <ion-label>
              <h2>SFX Code</h2>
              <p>{{ zero.code }}</p>
              <h2>Consignor</h2>
              <p>{{ zero.consignor }}</p>
            </ion-label>
            <ion-label slot="end">
              <h2>Last Pickup Date</h2>
              <p>{{ zero.lastPickupDate }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-content>
    </ng-template>
  </ion-modal>

  <!-- Modal for NOT MANIFESTED Details -->
  <ion-modal #notManifestedModal>
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>NOT MANIFESTED</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeNotManifestedModal()">Close</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <ion-list>
          <ion-item *ngFor="let notManifested of notManifestedData">
            <ion-label>
              <h2>WB#</h2>
              <p>{{ notManifested.waybill }}</p>
              <h2>Booked/MF/Remaining Pkgs</h2>
              <p>{{ notManifested.booked }}/{{ notManifested.manifested }}/{{ notManifested.remaining }}</p>
              <h2>Consignor</h2>
              <p>{{ notManifested.consignor }}</p>
            </ion-label>
            <ion-label slot="end">
              <h2>Pickup Date</h2>
              <p>{{ notManifested.pickupDate }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-content>
    </ng-template>
  </ion-modal>

  <!-- Modal for DRAFT WAYBILLS Details -->
  <ion-modal #draftWaybillsModal>
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>DRAFT WAYBILLS</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeDraftWaybillsModal()">Close</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <ion-list>
          <ion-item *ngFor="let draft of draftWaybillsData">
            <ion-label>
              <h2>WB#</h2>
              <p>{{ draft.waybill }}</p>
              <h2>Consignor</h2>
              <p>{{ draft.consignor }}</p>
            </ion-label>
            <ion-label slot="end">
              <h2>Pickup Date</h2>
              <p>{{ draft.pickupDate }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-content>
    </ng-template>
  </ion-modal>

  <!-- Modal for SH/EX Details -->
  <ion-modal #shExModal>
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>DE {{ selectedVehicle }} AS {{ selectedVehicle }}</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeShExModal()">Close</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <ion-list>
          <ion-item *ngFor="let detail of shExDetails">
            <ion-label>
              <h2>WB#</h2>
              <p>{{ detail.waybill }}</p>
              <h2>Booked/Manifest/Received</h2>
              <p>{{ detail.booked }}/{{ detail.manifested }}/{{ detail.received }}</p>
              <h2>Consignor</h2>
              <p>{{ detail.consignor }}</p>
            </ion-label>
            <ion-label slot="end">
              <h2>Pickup Date</h2>
              <p>{{ detail.pickupDate }}</p>
            </ion-label>
            <ion-button slot="end" [color]="detail.status === 'Short' ? 'danger' : 'success'">
              {{ detail.status }}
            </ion-button>
          </ion-item>
        </ion-list>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
